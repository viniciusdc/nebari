

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="../../_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="../../_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="../../_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="../../_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="652c90">
  <script src="../../_static/javascripts/modernizr.js"></script>
  
  
  
    <title>QHub Deployment on Google Cloud Platform (GCP) &#8212; QHub Code as Infrastructure.</title>
    <link rel="stylesheet" href="../../_static/material.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />

  
   

<style>
  .md-header, .md-tabs {background-color: #653c90}
</style>
  </head>
  <body dir=ltr
        data-md-color-primary=652c90 data-md-color-accent=light-yellow>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#docs/gcp/qhub-gcp-deployment" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../../index.html" title="QHub Code as Infrastructure."
           class="md-header-nav__button md-logo">
          
            &nbsp;
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">QHub</span>
          <span class="md-header-nav__topic"> QHub Deployment on Google Cloud Platform (GCP) </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="../../search.html" method="GET" name="search">
      <input type="text" class="md-search__input" name="q" placeholder="Search"
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            <a href="https://github.com/Quansight/qhub" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    QHub
  </div>
</a>
          </div>
        </div>
      
      
  
  <script src="../../_static/javascripts/version_dropdown.js"></script>
  <script>
    var json_loc = "../../"versions.json"",
        target_loc = "../../../",
        text = "Versions";
    $( document ).ready( add_version_dropdown(json_loc, target_loc, text));
  </script>
  

    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
          <li class="md-tabs__item"><a href="../../index.html" class="md-tabs__link">QHub Code as Infrastructure.</a></li>
            
            <li class="md-tabs__item"><a href="../../index.html" class="md-tabs__link">QHub Home</a></li>
            
            <li class="md-tabs__item"><a href="https://pypi.org/project/qhub/" class="md-tabs__link">Pypi</a></li>
            
            <li class="md-tabs__item"><a href="../faqs.html" class="md-tabs__link">FAQ</a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../../index.html" title="QHub Code as Infrastructure." class="md-nav__button md-logo">
      
        <img src="../../_static/" alt=" logo" width="48" height="48">
      
    </a>
    <a href="../../index.html"
       title="QHub Code as Infrastructure.">QHub</a>
  </label>
    <div class="md-nav__source">
      <a href="https://github.com/Quansight/qhub" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    QHub
  </div>
</a>
    </div>
  
  

  
  <ul class="md-nav__list">
    <li class="md-nav__item">
    
    
      <a href="../step-by-step-walkthrough.html" class="md-nav__link">Step-by-Step QHub Cloud Deployment</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../do/configuration.html" class="md-nav__link">Configuration</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../do/configuration.html#full-configuration-example" class="md-nav__link">Full Configuration Example</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../do/configuration.html#initializing-repository" class="md-nav__link">Initializing Repository</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../faqs.html" class="md-nav__link">Frequently Asked Questions (FAQ)</a>
      
    
    </li>
  </ul>
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#docs-gcp-qhub-gcp-deployment--page-root" class="md-nav__link">QHub Deployment on Google Cloud Platform (GCP)</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#configuration" class="md-nav__link">Configuration</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#general" class="md-nav__link">1. General</a>
        </li>
        <li class="md-nav__item"><a href="#security" class="md-nav__link">2. Security</a>
        </li>
        <li class="md-nav__item"><a href="#provider-infrastructure" class="md-nav__link">3. Provider Infrastructure</a>
        </li>
        <li class="md-nav__item"><a href="#default-images" class="md-nav__link">Default Images</a>
        </li>
        <li class="md-nav__item"><a href="#storage" class="md-nav__link">Storage</a>
        </li>
        <li class="md-nav__item"><a href="#profiles" class="md-nav__link">Profiles</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#environments" class="md-nav__link">Environments</a>
        </li></ul>
            </nav>
        </li>
    
<li class="md-nav__item"><a class="md-nav__extra_link" href="../../_sources/docs/gcp/qhub-gcp-deployment.md.txt">Show Source</a> </li>

<li id="searchbox" class="md-nav__item"></li>

  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  
<h1 id="docs-gcp-qhub-gcp-deployment--page-root">QHub Deployment on Google Cloud Platform (GCP)<a class="headerlink" href="#docs-gcp-qhub-gcp-deployment--page-root" title="Permalink to this headline">¶</a></h1>
<p>This quide walks you through the steps to create a QHub deployment on GCP. <strong>Deployments</strong> represent a set of multiple, identical Pods with no unique identities. A deployment runs multiple replicas of your application and automatically replaces any instances that fail or become unresponsive. In this way, deployments help ensure that one or more instances of your application are available to serve user requests. Deployments are managed by the Kubernetes Deployment controller.</p>
<p>A <strong>configuration</strong> defines the structure of your deployment, including the type and properties of the resources that are part of the deployment, any templates the configuration should use, and additional subfiles that can be executed to create your final configuration. You must specify a configuration in order to create a deployment. A configuration allows you to define a variety of resources and features that you would like to setup for your deployment. Let’s have a closer look into how you can configure your QHub deployment for GCP.</p>

<h2 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<p>You can start the deployment process by providing the configuration details of your project. To abstract away some of the complexities of writing up your own configuration file for QHub deployment on GCP, the configuration file, <code class="docutils literal notranslate"><span class="pre">qhub-config.yaml</span></code>, written in the <a class="reference external" href="https://yaml.org/about.html">YAML</a> syntax, is provided for you. The configuration file consists of three main sections: <strong>General, Security, Provider Infrastructure</strong> that you need to edit with your project and authentication details.</p>

<h3 id="general">1. General<a class="headerlink" href="#general" title="Permalink to this headline">¶</a></h3>
<p>This section allows setting up the general information about your project.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">project_name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">qhub-gcp-deployment</span>
<span class="nt">provider</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">gcp</span>
<span class="nt">ci_cd</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">github-actions</span>
<span class="nt">domain</span><span class="p">:</span> <span class="s">"gcp.qhub.dev"</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">project_name</span></code> is the name that the resources within the cloud deployment/kubernetes will be deployed with.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">provider</span></code> specifies which cloud provider to use for the deployment. For GCP, you will write <code class="docutils literal notranslate"><span class="pre">gcp</span></code>. Possible options include <code class="docutils literal notranslate"><span class="pre">do</span></code> for Digital Ocean and <code class="docutils literal notranslate"><span class="pre">aws</span></code> for Amazon Web Services.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ci_cd</span></code> refers to the continuous integration and continuous deployment framework to use. Currently, <a class="reference external" href="https://help.github.com/en/actions">github-actions</a> is the supported framework.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">domain</span></code> is the top level url to put qhub and future services under such a monitoring. In this example, <code class="docutils literal notranslate"><span class="pre">gcp.qhub.dev</span></code> would be the domain for qhub to be exposed under.</p></li>
</ul>


<h3 id="security">2. Security<a class="headerlink" href="#security" title="Permalink to this headline">¶</a></h3>
<p>The security section of the configuration file is for configuring security and authentication details, relating to your QHub deployment. You will need to provide your Google Cloud <a class="reference external" href="https://cloud.google.com/iam/docs/service-accounts">Service Account</a> credentials on the appropriate lines of the configuration file as shown below.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">security</span><span class="p">:</span>
  <span class="nt">authentication</span><span class="p">:</span>
    <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">GitHub</span>
    <span class="nt">config</span><span class="p">:</span>
      <span class="nt">client_id</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;CLIENT_ID&gt;</span>
      <span class="nt">client_secret</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;CLIENT_SECRET&gt;</span>
      <span class="nt">oauth_callback_url</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">https://jupyter.gcp.qhub.dev/hub/oauth_callback</span>
      <span class="nt">auth0_subdomain</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">qhub-dev</span>
</pre></div>
</div>
<p>To configure the oauth provider used for authentication, you will fill out the <code class="docutils literal notranslate"><span class="pre">security.authentication</span></code> section. You can choose the authentication type you would like to use. In the example above, the configuration shows authentication type as Github, but <code class="docutils literal notranslate"><span class="pre">Auth0</span></code> is also supported as seen below.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">security</span><span class="p">:</span>
  <span class="nt">authentication</span><span class="p">:</span>
    <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Auth0</span>
    <span class="nt">config</span><span class="p">:</span>
      <span class="nt">client_id</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;CLIENT_ID&gt;</span>
      <span class="nt">client_secret</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;CLIENT_SECRET&gt;</span>
      <span class="nt">oauth_callback_url</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">https://jupyter.gcp.qhub.dev/hub/oauth_callback</span>
      <span class="nt">scope</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">"openid"</span><span class="p p-Indicator">,</span> <span class="s">"email"</span><span class="p p-Indicator">,</span> <span class="s">"profile"</span><span class="p p-Indicator">]</span>
      <span class="nt">auth0_subdomain</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">qhub-dev</span>
</pre></div>
</div>
<p>The configuration file also allows you to specify <code class="docutils literal notranslate"><span class="pre">users</span></code> and <code class="docutils literal notranslate"><span class="pre">groups</span></code> that you would like to give access to your project and its deployment. This portion of the file enables you to provision unix permissions to each user. All users are assigned a <code class="docutils literal notranslate"><span class="pre">uid</span></code>, <code class="docutils literal notranslate"><span class="pre">primary_group</span></code> and optionally any number of <code class="docutils literal notranslate"><span class="pre">secondary_groups</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">primary_group</span></code> is the group name assigned to files that are written for the user while <code class="docutils literal notranslate"><span class="pre">groups</span></code> is simply a mapping of group name to group ids. It is recommended to not change the ids assigned to groups and users after creation since it may lead to login problems. While the example below shows ids around 100 and 1000, it is recommended to start with high uid numbers, such as 10000000. <code class="docutils literal notranslate"><span class="pre">ids</span></code>, technically, supports 2 billion <code class="docutils literal notranslate"><span class="pre">ids</span></code>.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">users</span><span class="p">:</span>
    <span class="nt">&lt;username1&gt;</span><span class="p">:</span>
      <span class="nt">uid</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1000</span>
      <span class="nt">primary_group</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">users</span>
      <span class="nt">secondary_groups</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">admin</span>
    <span class="nt">&lt;username2&gt;</span><span class="p">:</span>
      <span class="nt">uid</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1001</span>
      <span class="nt">primary_group</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">admin</span>
<span class="-Error">  </span><span class="nt">groups</span><span class="p">:</span>
    <span class="nt">users</span><span class="p">:</span>
      <span class="nt">gid</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">100</span>
    <span class="nt">admin</span><span class="p">:</span>
      <span class="nt">gid</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">101</span>
    <span class="nt">billing</span><span class="p">:</span>
      <span class="nt">gid</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">102</span>
</pre></div>
</div>


<h3 id="provider-infrastructure">3. Provider Infrastructure<a class="headerlink" href="#provider-infrastructure" title="Permalink to this headline">¶</a></h3>
<p>This section of the configuration file refers to the <a class="reference external" href="https://kubernetes.io/">kubernetes</a> infrastructure deployment on GCP. Kubernetes is a cloud agnostic, portable, extensible, open-source platform for managing containerized workloads and services that facilitates both declarative configuration and automation. Kubernetes runs your workload by placing containers into <a class="reference external" href="https://kubernetes.io/docs/concepts/workloads/pods/pod/">Pods</a> to run on <a class="reference external" href="https://kubernetes.io/docs/concepts/architecture/nodes/#:~:text=Nodes,machine%2C%20depending%20on%20the%20cluster.&amp;text=Typically%20you%20have%20several%20nodes,a%20node%20include%20the%20kubelet">Nodes</a>. A node may be a virtual or physical machine, depending on the cluster. The following configuration sets up a kubernetes deployment with <a class="reference external" href="https://kubernetes.io/blog/2016/07/autoscaling-in-kubernetes/">autoscaling</a> node groups.</p>
<p>Among the cloud service providers on which QHub can be deployed, GCP has the best support for QHub. This is mainly because it allows autoscaling to zero within a node group. To see available instance types, please refer to <a class="reference external" href="https://cloud.google.com/compute/docs/machine-types">gcp docs</a>.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">google_cloud_platform</span><span class="p">:</span>
  <span class="nt">project</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;project_id&gt;</span>
  <span class="nt">region</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">us-central1</span>
  <span class="nt">zone</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">us-central1-c</span>
  <span class="nt">availability_zones</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">"us-central1-c"</span><span class="p p-Indicator">]</span>
  <span class="nt">kubernetes_version</span><span class="p">:</span> <span class="s">"1.14.10-gke.31"</span>
  <span class="nt">node_groups</span><span class="p">:</span>
    <span class="nt">general</span><span class="p">:</span>
      <span class="nt">instance</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">n1-standard-2</span>
      <span class="nt">min_nodes</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
      <span class="nt">max_nodes</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
    <span class="nt">user</span><span class="p">:</span>
      <span class="nt">instance</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">n1-standard-2</span>
      <span class="nt">min_nodes</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>
      <span class="nt">max_nodes</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">2</span>
    <span class="nt">worker</span><span class="p">:</span>
      <span class="nt">instance</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">n1-standard-2</span>
      <span class="nt">min_nodes</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>
      <span class="nt">max_nodes</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5</span>
</pre></div>
</div>
<p>To interact with Google Cloud resources and perform a QHub deployment, you must provide the identifying project information for every request. On GCP, a project is identified by its project ID and project number. GCP deployment requires the project id and service account credentials.</p>
<p><code class="docutils literal notranslate"><span class="pre">GOOGLE_CREDENTIALS</span></code> must be the contents of the json credentials file with sufficient permissions to create all resources on the cluster. Detailed instructions on <a class="reference external" href="https://cloud.google.com/iam/docs/creating-managing-service-account-keys">creating service accounts can be found here</a>. <code class="docutils literal notranslate"><span class="pre">project_id</span></code> is a short string of around 32 characters that defines your project uniquely. To get the project ID and the project number, you will need to go to your GCP Dashboard as described <a class="reference external" href="https://cloud.google.com/resource-manager/docs/creating-managing-projects#identifying_projects">here</a> and fill in the <code class="docutils literal notranslate"><span class="pre">project_id</span></code> line in the configuration file. The service account will need <code class="docutils literal notranslate"><span class="pre">Project-&gt;Editor</span></code> permissions. In addition, you will need to enable the <code class="docutils literal notranslate"><span class="pre">Cloud</span> <span class="pre">Resource</span> <span class="pre">Manager</span> <span class="pre">API</span></code>. The QHub deployment will fail without the api enabled.</p>
<p>For GCP, as well as for the other cloud service providers, adding an additional node group is as easy as adding a node group such as <code class="docutils literal notranslate"><span class="pre">high-memory</span></code>.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">high-memory</span><span class="p">:</span>
  <span class="nt">instance</span><span class="p">:</span> <span class="s">"s-2vcpu-4gb"</span>
  <span class="nt">min_nodes</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
  <span class="nt">max_nodes</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">50</span>
</pre></div>
</div>


<h3 id="default-images">Default Images<a class="headerlink" href="#default-images" title="Permalink to this headline">¶</a></h3>
<p>An image is the term used to refer to a serialized copy of the state of an environment stored in a file. Default images section in the configuration file lists the images used to run the default image if it is not already specified in a profile (described in the next section). The <code class="docutils literal notranslate"><span class="pre">jupyterhub</span></code> key controls the jupyterhub image run.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">default_images</span><span class="p">:</span>
  <span class="nt">jupyterhub</span><span class="p">:</span> <span class="s">"quansight/qhub-jupyterhub:ce548a6b13bdcf494ccfa2a08a495b090f973cfe"</span>
  <span class="nt">jupyterlab</span><span class="p">:</span> <span class="s">"quansight/qhub-jupyterlab:ce548a6b13bdcf494ccfa2a08a495b090f973cfe"</span>
  <span class="nt">dask_worker</span><span class="p">:</span> <span class="s">"quansight/qhub-dask-worker:ce548a6b13bdcf494ccfa2a08a495b090f973cfe"</span>
</pre></div>
</div>


<h3 id="storage">Storage<a class="headerlink" href="#storage" title="Permalink to this headline">¶</a></h3>
<p>This section allows you to control the amount of storage allocated to shared filesystems. Please note, when you change the storage size, it will delete the previous storage.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">storage</span><span class="p">:</span>
  <span class="nt">conda_store</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">20Gi</span>
  <span class="nt">shared_filesytem</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10Gi</span>
</pre></div>
</div>


<h3 id="profiles">Profiles<a class="headerlink" href="#profiles" title="Permalink to this headline">¶</a></h3>
<p>Profiles are used to control the jupyterlab user instances and dask-workers provided by dask-gateway.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">profiles</span><span class="p">:</span>
  <span class="nt">jupyterlab</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">display_name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Small Instance</span>
      <span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Stable environment with 1 cpu / 1 GB ram</span>
      <span class="nt">users</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">&lt;username&gt;</span>
      <span class="nt">groups</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">admin</span>
      <span class="nt">default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
      <span class="nt">kubespawner_override</span><span class="p">:</span>
        <span class="nt">cpu_limit</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
        <span class="nt">cpu_guarentee</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
        <span class="nt">mem_limit</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1G</span>
        <span class="nt">mem_guarentee</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1G</span>
        <span class="nt">image</span><span class="p">:</span> <span class="s">"quansight/qhub-jupyterlab:ce548a6b13bdcf494ccfa2a08a495b090f973cfe"</span>
    <span class="p p-Indicator">-</span> <span class="nt">display_name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Medium Instance</span>
      <span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Stable environment with 1.5 cpu / 2 GB ram</span>
      <span class="nt">kubespawner_override</span><span class="p">:</span>
        <span class="nt">cpu_limit</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1.5</span>
        <span class="nt">cpu_guarentee</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1.25</span>
        <span class="nt">mem_limit</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">2G</span>
        <span class="nt">mem_guarentee</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">2G</span>
        <span class="nt">image</span><span class="p">:</span> <span class="s">"quansight/qhub-jupyterlab:ce548a6b13bdcf494ccfa2a08a495b090f973cfe"</span>

  <span class="nt">dask_worker</span><span class="p">:</span>
    <span class="s">"Small</span><span class="nv"> </span><span class="s">Worker"</span><span class="p p-Indicator">:</span>
      <span class="nt">worker_cores_limit</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
      <span class="nt">worker_cores</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
      <span class="nt">worker_memory_limit</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1G</span>
      <span class="nt">worker_memory</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1G</span>
      <span class="nt">image</span><span class="p">:</span> <span class="s">"quansight/qhub-dask-worker:ce548a6b13bdcf494ccfa2a08a495b090f973cfe"</span>
    <span class="s">"Medium</span><span class="nv"> </span><span class="s">Worker"</span><span class="p p-Indicator">:</span>
      <span class="nt">worker_cores_limit</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1.5</span>
      <span class="nt">worker_cores</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1.25</span>
      <span class="nt">worker_memory_limit</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">2G</span>
      <span class="nt">worker_memory</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">2G</span>
      <span class="nt">image</span><span class="p">:</span> <span class="s">"quansight/qhub-dask-worker:ce548a6b13bdcf494ccfa2a08a495b090f973cfe"</span>
</pre></div>
</div>
<p>For each <code class="docutils literal notranslate"><span class="pre">profiles.jupyterlab</span></code> is a named jupyterlab profile. It closely follows the [KubeSpawner](https://jupyterhub kubespawner.readthedocs.io/en/latest/spawner.html) api. The only exception is that two keys are added <code class="docutils literal notranslate"><span class="pre">users</span></code> and <code class="docutils literal notranslate"><span class="pre">groups</span></code> which allow restriction of profiles to a given set of groups and users. We recommend using groups to manage profile access. Finally, we allow for configuration of the <a class="reference external" href="https://distributed.dask.org/en/latest/worker.html">dask workers</a>. In general, similar to the jupyterlab instances, you only need to configure the cores and memory.</p>



<h2 id="environments">Environments<a class="headerlink" href="#environments" title="Permalink to this headline">¶</a></h2>
<p>An environment generally refers to a directory on your machine that contains a set of packages/dependencies that the program/application you want to run needs. One might think of a programming environment similar to a namespace as used in computer science, which refers to an abstract container (or environment) created to hold a logical grouping of names.</p>
<p>In your configuration file, you can add to the list of dependencies, as well as change the name of your environment if you would like to.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">environments</span><span class="p">:</span>
  <span class="s">"environment-default.yaml"</span><span class="p p-Indicator">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
    <span class="nt">channels</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">conda-forge</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">defaults</span>
    <span class="nt">dependencies</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">python=3.7</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ipykernel</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ipywidgets</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">dask==2.14.0</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">distributed==2.14.0</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">dask-gateway=0.6.1</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">numpy</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">numba</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">pandas</span>
</pre></div>
</div>
<p>After you edit the configuration file, run <code class="docutils literal notranslate"><span class="pre">./scripts/00-guided-install.sh</span></code> to complete the QHub GCP deployment steps!</p>




          </article>
        </div>
      </div>
    </main>
  </div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
          <div class="md-footer-copyright__highlight">
              &#169; Copyright .
              
          </div>
            Created using
            <a href="http://www.sphinx-doc.org/">Sphinx</a> 2.4.4.
             and
            <a href="https://github.com/bashtage/sphinx-material/">Material for
              Sphinx</a>
        </div>
      </div>
    </div>
  </footer>
  <script src="../../_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>