

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="../_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="../_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="652c90">
  <script src="../_static/javascripts/modernizr.js"></script>
  
  
  
    <title>Step-by-Step QHub Cloud Deployment &#8212; QHub Code as Infrastructure.</title>
    <link rel="stylesheet" href="../_static/material.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Configuration" href="do/configuration.html" />
    <link rel="prev" title="qhub documentation" href="../index.html" />

  
   

<style>
  .md-header, .md-tabs {background-color: #653c90}
</style>
  </head>
  <body dir=ltr
        data-md-color-primary=652c90 data-md-color-accent=light-yellow>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#docs/step-by-step-walkthrough" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../index.html" title="QHub Code as Infrastructure."
           class="md-header-nav__button md-logo">
          
            &nbsp;
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">QHub</span>
          <span class="md-header-nav__topic"> Step-by-Step QHub Cloud Deployment </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="../search.html" method="GET" name="search">
      <input type="text" class="md-search__input" name="q" placeholder="Search"
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            <a href="https://github.com/Quansight/qhub" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    QHub
  </div>
</a>
          </div>
        </div>
      
      
  
  <script src="../_static/javascripts/version_dropdown.js"></script>
  <script>
    var json_loc = "../"versions.json"",
        target_loc = "../../",
        text = "Versions";
    $( document ).ready( add_version_dropdown(json_loc, target_loc, text));
  </script>
  

    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
          <li class="md-tabs__item"><a href="../index.html" class="md-tabs__link">QHub Code as Infrastructure.</a></li>
            
            <li class="md-tabs__item"><a href="../index.html" class="md-tabs__link">QHub Home</a></li>
            
            <li class="md-tabs__item"><a href="https://pypi.org/project/qhub/" class="md-tabs__link">Pypi</a></li>
            
            <li class="md-tabs__item"><a href="faqs.html" class="md-tabs__link">FAQ</a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../index.html" title="QHub Code as Infrastructure." class="md-nav__button md-logo">
      
        <img src="../_static/" alt=" logo" width="48" height="48">
      
    </a>
    <a href="../index.html"
       title="QHub Code as Infrastructure.">QHub</a>
  </label>
    <div class="md-nav__source">
      <a href="https://github.com/Quansight/qhub" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    QHub
  </div>
</a>
    </div>
  
  

  
  <ul class="md-nav__list">
    <li class="md-nav__item">
    
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    <label class="md-nav__link md-nav__link--active" for="__toc"> Step-by-Step QHub Cloud Deployment </label>
    
      <a href="#" class="md-nav__link md-nav__link--active">Step-by-Step QHub Cloud Deployment</a>
      
        
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#docs-step-by-step-walkthrough--page-root" class="md-nav__link">Step-by-Step QHub Cloud Deployment</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#install-qhub" class="md-nav__link">1. Install QHub</a>
        </li>
        <li class="md-nav__item"><a href="#environment-variables" class="md-nav__link">2. Environment variables</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#cloudflare" class="md-nav__link">2.1 Cloudflare</a>
        </li>
        <li class="md-nav__item"><a href="#auth0" class="md-nav__link">2.2 Auth0</a>
        </li>
        <li class="md-nav__item"><a href="#github" class="md-nav__link">2.3 GitHub</a>
        </li>
        <li class="md-nav__item"><a href="#cloud-provider-credentials" class="md-nav__link">2.4 Cloud Provider Credentials</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#amazon-web-services" class="md-nav__link">2.4.1 Amazon Web Services</a>
        </li>
        <li class="md-nav__item"><a href="#digital-ocean" class="md-nav__link">2.4.2 Digital Ocean</a>
        </li>
        <li class="md-nav__item"><a href="#google-cloud-platform" class="md-nav__link">2.4.3 Google Cloud Platform</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#qhub-init" class="md-nav__link">2.5 QHub init</a>
        </li>
        <li class="md-nav__item"><a href="#qhub-render" class="md-nav__link">2.6 QHub render</a>
        </li>
        <li class="md-nav__item"><a href="#qhub-deploy" class="md-nav__link">2.7 QHub deploy</a>
        </li>
        <li class="md-nav__item"><a href="#push-repository" class="md-nav__link">2.8 Push repository</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#post-github-deployment" class="md-nav__link">3. Post GitHub deployment:</a>
        </li>
        <li class="md-nav__item"><a href="#gitops-enabled" class="md-nav__link">4. GitOps enabled</a>
        </li></ul>
            </nav>
        </li>
    
<li class="md-nav__item"><a class="md-nav__extra_link" href="../_sources/docs/step-by-step-walkthrough.md.txt">Show Source</a> </li>

  </ul>
</nav>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="do/configuration.html" class="md-nav__link">Configuration</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="do/configuration.html#full-configuration-example" class="md-nav__link">Full Configuration Example</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="do/configuration.html#initializing-repository" class="md-nav__link">Initializing Repository</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="faqs.html" class="md-nav__link">Frequently Asked Questions (FAQ)</a>
      
    
    </li>
  </ul>
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#docs-step-by-step-walkthrough--page-root" class="md-nav__link">Step-by-Step QHub Cloud Deployment</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#install-qhub" class="md-nav__link">1. Install QHub</a>
        </li>
        <li class="md-nav__item"><a href="#environment-variables" class="md-nav__link">2. Environment variables</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#cloudflare" class="md-nav__link">2.1 Cloudflare</a>
        </li>
        <li class="md-nav__item"><a href="#auth0" class="md-nav__link">2.2 Auth0</a>
        </li>
        <li class="md-nav__item"><a href="#github" class="md-nav__link">2.3 GitHub</a>
        </li>
        <li class="md-nav__item"><a href="#cloud-provider-credentials" class="md-nav__link">2.4 Cloud Provider Credentials</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#amazon-web-services" class="md-nav__link">2.4.1 Amazon Web Services</a>
        </li>
        <li class="md-nav__item"><a href="#digital-ocean" class="md-nav__link">2.4.2 Digital Ocean</a>
        </li>
        <li class="md-nav__item"><a href="#google-cloud-platform" class="md-nav__link">2.4.3 Google Cloud Platform</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#qhub-init" class="md-nav__link">2.5 QHub init</a>
        </li>
        <li class="md-nav__item"><a href="#qhub-render" class="md-nav__link">2.6 QHub render</a>
        </li>
        <li class="md-nav__item"><a href="#qhub-deploy" class="md-nav__link">2.7 QHub deploy</a>
        </li>
        <li class="md-nav__item"><a href="#push-repository" class="md-nav__link">2.8 Push repository</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#post-github-deployment" class="md-nav__link">3. Post GitHub deployment:</a>
        </li>
        <li class="md-nav__item"><a href="#gitops-enabled" class="md-nav__link">4. GitOps enabled</a>
        </li></ul>
            </nav>
        </li>
    
<li class="md-nav__item"><a class="md-nav__extra_link" href="../_sources/docs/step-by-step-walkthrough.md.txt">Show Source</a> </li>

<li id="searchbox" class="md-nav__item"></li>

  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  
<h1 id="docs-step-by-step-walkthrough--page-root">Step-by-Step QHub Cloud Deployment<a class="headerlink" href="#docs-step-by-step-walkthrough--page-root" title="Permalink to this headline">¶</a></h1>
<p>The list below is our suggestion. Other providers may be used, but you will need to consult their documentation. When using a different provider the corresponding flag in the <code class="docutils literal notranslate"><span class="pre">qhub</span></code> command-line argument should be omitted.</p>
<p>For this initial tutorial, we assume that you will use the following tools:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/features/actions">Github actions</a> will be used for CI/CD</p></li>
<li><p>Oauth will be via <a class="reference external" href="https://auth0.com/">auth0</a></p></li>
<li><p>DNS registry will be through <a class="reference external" href="https://www.cloudflare.com/">Cloudflare</a></p></li>
</ul>

<h2 id="install-qhub">1. Install QHub<a class="headerlink" href="#install-qhub" title="Permalink to this headline">¶</a></h2>
<p>Following best practice, we recommend that you create a virtual environment previously and from there install QHub on machine:</p>
<ul class="simple">
<li><p>If you prefer conda, install the latest stable release with :</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>    conda install -c conda-forge qhub
</pre></div>
</div>
<ul class="simple">
<li><p>If you are a PyPI user instead, download the latest stable release with:</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>    pip install qhub
</pre></div>
</div>
<ul class="simple">
<li><p>(For developers) The latest development version can be installed using PyPI:</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>    pip install git+https://github.com/Quansight/qhub.git
</pre></div>
</div>
<blockquote>
<div><p>NOTE: Download the ‘development version’ to try out features which have not been yet officially released.</p>
</div></blockquote>


<h2 id="environment-variables">2. Environment variables<a class="headerlink" href="#environment-variables" title="Permalink to this headline">¶</a></h2>
<p>In order to fully automate the deployment, several environment variables must be set. The following subsections will
describe the purpose and method for obtaining the values for these variables. An introduction to unix environment variables can be found <a class="reference external" href="https://en.wikipedia.org/wiki/Environment_variable">here</a>.</p>

<h3 id="cloudflare">2.1 Cloudflare<a class="headerlink" href="#cloudflare" title="Permalink to this headline">¶</a></h3>
<p>Cloudflare will automate the DNS registration. First a <a class="reference external" href="https://dash.cloudflare.com/sign-up">Cloudflare</a> account needs to be created and
<a class="reference external" href="https://www.cloudflare.com/products/registrar/">domain name</a> registered through it. If an alternate DNS provider is desired, then omit the <code class="docutils literal notranslate"><span class="pre">--dns-provider</span> <span class="pre">cloudflare</span></code>
flag for <code class="docutils literal notranslate"><span class="pre">qhub</span> <span class="pre">deploy</span></code>. At the end of deployment an IP address (or CNAME for AWS) will be output that can be registered
to your desired URL.</p>
<p>Within your Cloudflare account, follow these steps to generate a token</p>
<ul class="simple">
<li><p>Click user icon on top right and click <code class="docutils literal notranslate"><span class="pre">My</span> <span class="pre">Profile</span></code></p></li>
<li><p>Click the <code class="docutils literal notranslate"><span class="pre">API</span> <span class="pre">Tokens</span></code> menu and select <code class="docutils literal notranslate"><span class="pre">Create</span> <span class="pre">Token</span></code></p></li>
<li><p>Click <code class="docutils literal notranslate"><span class="pre">Use</span> <span class="pre">Template</span></code> next to <code class="docutils literal notranslate"><span class="pre">Edit</span> <span class="pre">zone</span> <span class="pre">DNS</span></code></p></li>
<li><p>Under <code class="docutils literal notranslate"><span class="pre">Permissions</span></code> in addition to <code class="docutils literal notranslate"><span class="pre">Zone</span> <span class="pre">|</span> <span class="pre">DNS</span> <span class="pre">|</span> <span class="pre">Edit</span></code> use the <code class="docutils literal notranslate"><span class="pre">Add</span> <span class="pre">more</span></code> button to add <code class="docutils literal notranslate"><span class="pre">Zone</span> <span class="pre">|</span> <span class="pre">Zone</span> <span class="pre">|</span> <span class="pre">Read</span></code>, <code class="docutils literal notranslate"><span class="pre">Zone</span> <span class="pre">|</span> <span class="pre">Zone</span> <span class="pre">Settings</span> <span class="pre">|</span> <span class="pre">Read</span></code>, and <code class="docutils literal notranslate"><span class="pre">Account</span> <span class="pre">|</span> <span class="pre">Account</span> <span class="pre">Settings</span> <span class="pre">|</span> <span class="pre">Read</span></code> to the Permissions</p></li>
<li><p>Under <code class="docutils literal notranslate"><span class="pre">Account</span> <span class="pre">Resources</span></code> set the first box to <code class="docutils literal notranslate"><span class="pre">Include</span></code> and the second to your desired account</p></li>
<li><p>Under <code class="docutils literal notranslate"><span class="pre">Zone</span> <span class="pre">Resources</span></code> set it to <code class="docutils literal notranslate"><span class="pre">Include</span> <span class="pre">|</span> <span class="pre">Specific</span> <span class="pre">zone</span></code> and your domain name</p></li>
<li><p>Click continue to summary</p></li>
<li><p>Click Create Token</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CLOUDFLARE_TOKEN</span></code>: Set this variable equal to the token generated</p></li>
</ul>


<h3 id="auth0">2.2 Auth0<a class="headerlink" href="#auth0" title="Permalink to this headline">¶</a></h3>
<p>After creating an <a class="reference external" href="https://auth0.com/">Auth0</a> account and logging in, follow these steps to create a access token:</p>
<ul class="simple">
<li><p>Click Applications on the left</p></li>
<li><p>Click <code class="docutils literal notranslate"><span class="pre">Create</span> <span class="pre">Application</span></code></p></li>
<li><p>Select <code class="docutils literal notranslate"><span class="pre">Machine</span> <span class="pre">to</span> <span class="pre">Machine</span> <span class="pre">Applications</span></code></p></li>
<li><p>Select <code class="docutils literal notranslate"><span class="pre">Auth0</span> <span class="pre">Management</span> <span class="pre">API</span></code> from the dropdown</p></li>
<li><p>Click <code class="docutils literal notranslate"><span class="pre">All</span></code> next to <code class="docutils literal notranslate"><span class="pre">Select</span> <span class="pre">all</span></code> and click <code class="docutils literal notranslate"><span class="pre">Authorize</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">AUTH0_CLIENT_ID</span></code>: Set this variable equal to the <code class="docutils literal notranslate"><span class="pre">Cliend</span> <span class="pre">ID</span></code> string under <code class="docutils literal notranslate"><span class="pre">Settings</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">AUTH0_CLIENT_SECRET</span></code>: Set this variable equal to the <code class="docutils literal notranslate"><span class="pre">Client</span> <span class="pre">Secret</span></code> string under <code class="docutils literal notranslate"><span class="pre">Settings</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">AUTH0_DOMAIN</span></code>: Set this variable to be equal to your account name (indicated on the upper right) appended with <code class="docutils literal notranslate"><span class="pre">.auth0.com</span></code>. IE an account called <code class="docutils literal notranslate"><span class="pre">qhub-test</span></code> would have this variable set to <code class="docutils literal notranslate"><span class="pre">qhub-test.auth0.com</span></code></p></li>
</ul>


<h3 id="github">2.3 GitHub<a class="headerlink" href="#github" title="Permalink to this headline">¶</a></h3>
<p>Your github username and access token will automate the creation of the repository that will hold the infrastructure code as well as the github secrets</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">GITHUB_USERNAME</span></code>: Set this to your github username</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">GITHUB_TOKEN</span></code>: Set this equal to your <a class="reference external" href="https://docs.github.com/en/free-pro-team@latest/github/authenticating-to-github/creating-a-personal-access-token">github access token</a></p></li>
</ul>


<h3 id="cloud-provider-credentials">2.4 Cloud Provider Credentials<a class="headerlink" href="#cloud-provider-credentials" title="Permalink to this headline">¶</a></h3>
<p>The access key for the cloud providers require fairly wide permissions in order for QHub to deploy. As such, all testing for QHUb has been done with owner/admin level permissions. We welcome testing to determine the minimum required permissions for deployment <a class="reference external" href="https://github.com/Quansight/qhub/issues/173">(open issue)</a>.</p>

<h4 id="amazon-web-services">2.4.1 Amazon Web Services<a class="headerlink" href="#amazon-web-services" title="Permalink to this headline">¶</a></h4>
<p>Please see these instructions for <a class="reference external" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_create.html">creating an IAM role</a> with admin permissions and set the below variables.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">AWS_ACCESS_KEY_ID</span></code>: The public key for an IAM account</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">AWS_SECRET_ACCESS_KEY</span></code>: The Private key for an IAM account</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">AWS_DEFAULT_REGION</span></code>: The region where you intend to deploy QHub</p></li>
</ul>


<h4 id="digital-ocean">2.4.2 Digital Ocean<a class="headerlink" href="#digital-ocean" title="Permalink to this headline">¶</a></h4>
<p>In order to get the DigitalOcean access keys follow this <a class="reference external" href="https://www.digitalocean.com/community/tutorials/how-to-create-a-digitalocean-space-and-api-key">digitalocean tutorial</a>.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">DIGITALOCEAN_TOKEN</span></code>: Follow <a class="reference external" href="https://www.digitalocean.com/docs/apis-clis/api/create-personal-access-token/">these instructions</a> to create a digital ocean token</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SPACES_ACCESS_KEY_ID</span></code>: Follow <a class="reference external" href="https://www.digitalocean.com/community/tutorials/how-to-create-a-digitalocean-space-and-api-key">this guide</a> to create a spaces access key/secret</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SPACES_SECRET_ACCESS_KEY</span></code>: The secret from the above instructions</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">AWS_ACCESS_KEY_ID</span></code>: Due to a <a class="reference external" href="https://www.terraform.io/">terraform</a> quirk, set to the same as <code class="docutils literal notranslate"><span class="pre">SPACES_ACCESS_KEY_ID</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">AWS_SECRET_ACCESS_KEY</span></code>: Due to the quirk, set to the same as <code class="docutils literal notranslate"><span class="pre">SPACES_SECRET_ACCESS_KEY</span></code></p></li>
</ul>


<h4 id="google-cloud-platform">2.4.3 Google Cloud Platform<a class="headerlink" href="#google-cloud-platform" title="Permalink to this headline">¶</a></h4>
<p>Follow <a class="reference external" href="https://cloud.google.com/iam/docs/creating-managing-service-accounts">these detailed instructions</a> on creating a Google service account with an owner level permissions. With the service account created, follow <a class="reference external" href="https://cloud.google.com/iam/docs/creating-managing-service-account-keys#iam-service-account-keys-create-console">these steps</a> to create and download a json credentials file.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">GOOGLE_CREDENTIALS</span></code>: Set this to the path to your credentials file</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PROJECT_ID</span></code>: Set this to the project ID listed on the home page of your Google console under <code class="docutils literal notranslate"><span class="pre">Project</span> <span class="pre">info</span></code></p></li>
</ul>
<p>We’re done with the hardest part of deployment!</p>



<h3 id="qhub-init">2.5 QHub init<a class="headerlink" href="#qhub-init" title="Permalink to this headline">¶</a></h3>
<p>The next step is to run <code class="docutils literal notranslate"><span class="pre">qhub</span> <span class="pre">init</span></code> to generate the configuration file <code class="docutils literal notranslate"><span class="pre">qhub-config.yaml</span></code>. This file is where the vast majority of tweaks to the system will be made. There are are several optional (yet highly recommended) flags that deal with automating the deployment:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">--project</span></code>: Chose a name that <a class="reference external" href="https://www.google.com/search?q=s3+compliant+name&amp;oq=s3+compliant+name&amp;aqs=chrome..69i57j0.3611j0j7&amp;sourceid=chrome&amp;ie=UTF-8">is a compliant name for S3/Storage buckets</a>. IE <code class="docutils literal notranslate"><span class="pre">test-cluster</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--domain</span></code>: This is the base domain for your cluster. After deployment, the DNS will use the base name prepended with <code class="docutils literal notranslate"><span class="pre">jupyter</span></code>. IE if the base name is <code class="docutils literal notranslate"><span class="pre">test.qhub.dev</span></code> then the DNS will be provisioned as <code class="docutils literal notranslate"><span class="pre">jupyter.test.qhub.dev</span></code>. This pattern is also applicable if you are setting your own DNS through a different provider.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--ci-provider</span></code>: This specifies what provider to use for ci-cd. Currently github-actions is supported.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--oauth-provider</span></code>: This will set configuration file to use auth0 for authentication</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--oauth-auto-provision</span></code>: This will automatically create and configure an auth0 application</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--repository</span></code>: The repository name that will be used to store the infrastructure as code</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--repository-auto-provision</span></code>: This sets the secrets for the github repository</p></li>
</ul>
<p>Best practices is to create a new directory and run all the qhub commands inside of it. An example of the full command is below:</p>
<p><code class="docutils literal notranslate"><span class="pre">qhub</span> <span class="pre">init</span> <span class="pre">gcp</span> <span class="pre">--project</span> <span class="pre">test-project</span> <span class="pre">--domain</span> <span class="pre">test.qhub.dev</span> <span class="pre">--ci-provider</span> <span class="pre">github-actions</span> <span class="pre">--oauth-provider</span> <span class="pre">auth0</span> <span class="pre">--oauth-auto-provision</span> <span class="pre">--repository</span> <span class="pre">github.com/quansight/qhub-test</span> <span class="pre">--repository-auto-provision</span></code></p>


<h3 id="qhub-render">2.6 QHub render<a class="headerlink" href="#qhub-render" title="Permalink to this headline">¶</a></h3>
<p>After initializing, we then need to create all of terraform configuration. This done by running:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>    qhub render -c qhub-config.yaml -o ./ -f
</pre></div>
</div>
<p>You will notice that several directories are created:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">environments</span></code> : conda environments are stored</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">infrastructure</span></code> : terraform files that declare state of infrastructure</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">terraform-state</span></code> : required by terraform to securly store the state of the terraform deployment</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">image</span></code> : docker images used in qhub deployment including: jupyterhub, jupyterlab, and dask-gateway</p></li>
</ul>


<h3 id="qhub-deploy">2.7 QHub deploy<a class="headerlink" href="#qhub-deploy" title="Permalink to this headline">¶</a></h3>
<p>Finally we can deploy with:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>qhub deploy -c qhub-config.yaml --dns-provider cloudflare --dns-auto-provision
</pre></div>
</div>
<p>The terminal will prompt to press <code class="docutils literal notranslate"><span class="pre">[enter]</span></code> to check oauth credentials (which were added by qhub init). After pressing <code class="docutils literal notranslate"><span class="pre">enter</span></code> the deployment will continue and take roughly 10 minutes. Part of the output will show an “ip” address (DO/GCP) or a CNAME “hostname” (AWS) based on the the cloud service provider:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Digital Ocean/Google Cloud Platform:
   
    Outputs:

    ingress_jupyter = {
    "hostname" = ""
    "ip" = "xxx.xxx.xxx.xxx"
    }

AWS:       
    Outputs:

    ingress_jupyter = {
    "hostname" = "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx-xxxxxxxxxx.us-east-1.elb.amazonaws.com"
    "ip" = ""
    }
</pre></div>
</div>


<h3 id="push-repository">2.8 Push repository<a class="headerlink" href="#push-repository" title="Permalink to this headline">¶</a></h3>
<p>Add all files to github:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>git add .github/ .gitignore README.md environments/ image/ infrastructure/ qhub-config.yaml  terraform-state/
</pre></div>
</div>
<p>Push the changes to your repo:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>git push origin main
</pre></div>
</div>



<h2 id="post-github-deployment">3. Post GitHub deployment:<a class="headerlink" href="#post-github-deployment" title="Permalink to this headline">¶</a></h2>
<p>After the files are in Github all CI/CD changes will be triggered by a commit to main and deployed via GitHub actions. To use gitops, make a change to <code class="docutils literal notranslate"><span class="pre">qhub-ops.yaml</span></code> in a new branch and create a pull request into main. When the pull request is merged, it will trigger a deployment of all of those changes to your QHub.</p>
<p>The first thing you will want to do is add users to your new QHub. Any type of supported authorization from auth0 can be used as a username. Below is an example configuration of 2 users:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>    joeuser@example:
        uid: 1000000
        primary_group: users
        secondary_groups:
            - billing
            - admin
    janeuser@example.com:
        uid: 1000001
        primary_group: users
</pre></div>
</div>
<p>As seen above, each username has a unique <code class="docutils literal notranslate"><span class="pre">uid</span></code> and a <code class="docutils literal notranslate"><span class="pre">primary_group</span></code>.
Optional <code class="docutils literal notranslate"><span class="pre">secondary_groups</span></code> may also be set for each user.</p>


<h2 id="gitops-enabled">4. GitOps enabled<a class="headerlink" href="#gitops-enabled" title="Permalink to this headline">¶</a></h2>
<p>Since the infrastructure state is reflected in the repository, it allows self-documenting of infrastructure and team
members to submit pull requests that can be reviewed before modifying the infrastructure.</p>
<p>Congratulations! You have now completed your QHub cloud deployment!</p>




          </article>
        </div>
      </div>
    </main>
  </div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
            <a href="../index.html" title="qhub documentation"
               class="md-flex md-footer-nav__link md-footer-nav__link--prev"
               rel="prev">
              <div class="md-flex__cell md-flex__cell--shrink">
                <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
              </div>
              <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
                <span class="md-flex__ellipsis">
                  <span
                      class="md-footer-nav__direction"> Previous </span> <code class="docutils literal notranslate"><span class="pre">qhub</span></code> documentation </span>
              </div>
            </a>
          
          
            <a href="do/configuration.html" title="Configuration"
               class="md-flex md-footer-nav__link md-footer-nav__link--next"
               rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span
                class="md-flex__ellipsis"> <span
                class="md-footer-nav__direction"> Next </span> Configuration </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><i
                class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
          <div class="md-footer-copyright__highlight">
              &#169; Copyright .
              
          </div>
            Created using
            <a href="http://www.sphinx-doc.org/">Sphinx</a> 2.4.4.
             and
            <a href="https://github.com/bashtage/sphinx-material/">Material for
              Sphinx</a>
        </div>
      </div>
    </div>
  </footer>
  <script src="../_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>